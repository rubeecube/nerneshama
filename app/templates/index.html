{% from "_screenhelper.html" import render_neshamot %}

{% extends "bootstrap/base.html" %}

{% block styles %}
{{super()}}
<link rel="stylesheet" href="/static/styles/style.css">
{% endblock %}

{% block scripts %}
{{super()}}
<script>
    $( document ).ready(function() {
		for (var i = 0; i < 6; i = i+1){
			$('#box_' + i + ' .wrapper_flex .box_content .text > span.autofit').each(function(){
				if( $(this).parent().width() < $(this).width() ) {
					$(this).css('font-size', (parseInt($(this).css('font-size')) * $(this).parent().width()/$(this).width())*0.8 + "px" );
				}else{
					$(this).css('font-size', (Math.floor(parseFloat($(this).css('font-size'))*$(this).parent().width()/$(this).width()))*0.8 + "px" );
				}
			});
		}
	//setInterval(function() {
			$.get('ajax_data?json_output', {}, function (ajax_data_text) {
				$.get('ajax_data?html_skeleton&ratio=1', {}, function (skeleton1) {
					$.get('ajax_data?html_skeleton&ratio=2', {}, function (skeleton2) {
						ajax_data = JSON.parse(ajax_data_text);
						i = 0;
						v = 6;
						setInterval(function() {
							new_html = "";

							if (i==0) new_html = skeleton2;
							else new_html = skeleton1;

							var $div = $("<div>").html(new_html);

							$div.find(".nom_francais").first().html(new Option(ajax_data[v].nom_francais).innerHTML);
							$div.find(".nom_hebreu").first().html(new Option(ajax_data[v].nom_hebreu).innerHTML);
							$div.find(".date_deces_g").first().html(new Option(ajax_data[v].date_deces_g).innerHTML);
							$div.find(".date_deces").first().html(new Option(ajax_data[v].date_deces).innerHTML);
							if (ajax_data[v].less_than_1year == true){
								$div.find(".hazcara").first().html(new Option(ajax_data[v].hazcara11).innerHTML + " - " + new Option(ajax_data[v].hazcara11_g).innerHTML);
							}else{
								$div.find(".hazcara").first().html(new Option(ajax_data[v].hazcara1_g).innerHTML);
							}

							$('#box_' + i).html($div.html());

							$('#box_' + i + ' .wrapper_flex .box_content .text > span.autofit').each(function(){
								if( $(this).parent().width()*0.8 < $(this).width() ) {
									$(this).css('font-size', (parseInt($(this).css('font-size')) * $(this).parent().width()/$(this).width())*0.8 + "px" );
								}else{
									$(this).css('font-size', (Math.floor(parseFloat($(this).css('font-size'))*$(this).parent().width()/$(this).width()))*0.8 + "px" );
								}
							});

							i = (i+1) % 6;
							v = (v+1) % ajax_data.length;

						}, 5000); // Check refresh every 30 sec
					});
				});
			});
	  	//}, 1800000); // Check refresh every 30 min
    });
</script>
{% endblock %}

{% block title %} Productivity tools {% endblock %}
{% block content %}
{% if not start %}
	{% set start = 0 %}
{% endif %}

<div class="wrapper_flex_row">
	<div id="ajax_refresh" class="wrapper_grid" style="grid-template-columns: repeat(3, 1fr); grid-template-rows: repeat(3, 1fr);">
	{% set screens = [ ('2/4', '2/4'), ('1','1'), ('2','1'), ('3','1'), ('1','2'), ('1','3')]  %}
	{{ render_neshamot(screens, neshamot, start) }}
	</div>
	<div class="wrapper_grid" style="width:auto; grid-template-columns: repeat(1, 1fr); grid-template-rows: repeat(3, 1fr);">
	  <div class="grid_box" style="grid-column: 1; grid-row: 1/3;">
		<div id="divTileZmanim">
		  <table id="tableZmanim" width="100%" cellspacing="0" cellpadding="2" border="0">
			  <colgroup align="left"></colgroup><colgroup align="right"></colgroup>
			  <tbody>
				<tr>
					<td colspan="3">
						<table width="100%" cellspacing="0" cellpadding="0" border="0">
							<tbody>
								<tr>
									<td align="center">
										<span>Tel-Aviv - 124 Rothschild</span> <br>
										<span> {{ now }} - {{ nowH }} </span> <br>
										<span> Parasha: {{ parasha }} </span> <br>
									</td>
								</tr>
							  </tbody>
						</table>
					</td>
				</tr>
			  </tbody>
				<tbody>
				<tr>
					<td>Alot haShaḥar</td>
						<td>{{zmanim.first_light}}</td>
						<td>עלות&nbsp;השחר</td>
				</tr>
				<tr>
						<td>Hanetz</td>
						<td>{{zmanim.sunrise}}</td>
						<td>הנץ&nbsp;החמה</td>
				</tr>
					<tr class="even">
						<td>Limite shéma (M"A)</td>
						<td>{{zmanim.mga_end_shma}}</td>
					</tr>
					<tr class="even">
						<td>Limite shéma (GR"A)</td>
						<td>{{zmanim.gra_end_shma}}</td>
					</tr>
					<tr>
						<td>Limite tefila (GR"A)</td>
						<td>{{zmanim.gra_end_tfila}}</td>
					</tr>
					<tr class="even">
						<td>Hatzot</td>
						<td>{{zmanim.midday}}</td>
						<td>חצות&nbsp;יום</td>
					</tr>
					<tr>
						<td>Minḥa guedola</td>
						<td>{{zmanim.big_mincha}}</td>
						<td>מנחה&nbsp;גדולה</td>
					</tr>
					<tr>
						<td>Minḥa ketana</td>
						<td>{{zmanim.small_mincha}}</td>
						<td>מנחה&nbsp;קטנה</td>
					</tr>
					<tr>
						<td>Plag haminḥa (GR"A)</td>
						<td>{{zmanim.plag_mincha}}</td>
						<td>פלג&nbsp;המנחה</td>
					</tr>
					<tr class="even">
						<td>Shqi'â</td>
						<td>{{zmanim.sunset}}</td>
						<td>שקיעת החמה</td>
					</tr>
					<tr>
						<td>Tzeit hacokhavim</td>
						<td>{{zmanim.stars_out}}</td>
					</tr>
					<tr>
						<td>Hatzot layla</td>
						<td>{{zmanim.midnight}}</td>
					</tr>
				</tbody>
			  </table>
			<table width="100%" cellspacing="0" cellpadding="0" border="0">
				<tbody>
					<tr>
						<td align="center">
							<span> Prochain Yom Tov <br> {{ upcoming }} <br> {{ upcoming_date_g }} - {{ upcoming_date }} </span>
						</td>
					</tr>
				  </tbody>
			</table>
			 </div>
	  </div>
	  <div class="grid_box" style="grid-column: 1; grid-row: 3;">
		  <center>
			  Ajouter une date personalisée:
			 <image src="{{ qrcode_url }}"></image>
		  </center>
	  </div>
	</div>
</div>
{% endblock %}